(()=>{"use strict";const e=(...e)=>{},t=(...e)=>{console.info("[Compr Extension]",...e)},i=(...e)=>{console.warn("[Compr Extension]",...e)},r=(...e)=>{console.error("[Compr Extension]",...e)},o=[{keywords:["leggings","yoga pants","tights","athletic pants"],category:{tier1:"Women",tier2:"Athletic Apparel",tier3:"Pants, Tights, Leggings"}},{keywords:["athletic shorts","running shorts","yoga shorts","bike shorts"],category:{tier1:"Women",tier2:"Athletic Apparel",tier3:"Shorts"}},{keywords:["sports bra","athletic top","workout top","gym top"],category:{tier1:"Women",tier2:"Athletic Apparel",tier3:"Tops"}},{keywords:["activewear","athletic","workout","gym","yoga","fitness"],category:{tier1:"Women",tier2:"Athletic Apparel"}},{keywords:["t-shirt","tee","tshirt"],category:{tier1:"Women",tier2:"Tops & Blouses",tier3:"T-Shirts"}},{keywords:["tank top","cami","camisole"],category:{tier1:"Women",tier2:"Tops & Blouses",tier3:"Tank, Cami"}},{keywords:["blouse","dress shirt"],category:{tier1:"Women",tier2:"Tops & Blouses",tier3:"Blouses"}},{keywords:["top","shirt","tunic"],category:{tier1:"Women",tier2:"Tops & Blouses"}},{keywords:["mini dress","short dress"],category:{tier1:"Women",tier2:"Dresses",tier3:"Mini"}},{keywords:["midi dress","knee length dress"],category:{tier1:"Women",tier2:"Dresses",tier3:"Midi"}},{keywords:["maxi dress","long dress","floor length"],category:{tier1:"Women",tier2:"Dresses",tier3:"Maxi"}},{keywords:["dress","gown","sundress"],category:{tier1:"Women",tier2:"Dresses"}},{keywords:["sneakers","tennis shoes","running shoes","trainers","athletic shoes"],category:{tier1:"Women",tier2:"Shoes",tier3:"Athletic"}},{keywords:["heels","pumps","stiletto"],category:{tier1:"Women",tier2:"Shoes",tier3:"Heels"}},{keywords:["boots","ankle boots","booties"],category:{tier1:"Women",tier2:"Shoes",tier3:"Boots"}},{keywords:["sandals","flip flops","slides"],category:{tier1:"Women",tier2:"Shoes",tier3:"Sandals"}},{keywords:["flats","ballet flats","loafers"],category:{tier1:"Women",tier2:"Shoes",tier3:"Flats"}},{keywords:["crossbody","crossbody bag","cross body"],category:{tier1:"Women",tier2:"Bags & Purses",tier3:"Crossbody"}},{keywords:["shoulder bag","hobo bag"],category:{tier1:"Women",tier2:"Bags & Purses",tier3:"Shoulder Bag"}},{keywords:["tote","tote bag"],category:{tier1:"Women",tier2:"Bags & Purses",tier3:"Tote"}},{keywords:["backpack"],category:{tier1:"Women",tier2:"Bags & Purses",tier3:"Backpack"}},{keywords:["wallet","coin purse","wristlet"],category:{tier1:"Women",tier2:"Bags & Purses",tier3:"Wallet"}},{keywords:["clutch"],category:{tier1:"Women",tier2:"Bags & Purses",tier3:"Clutch"}},{keywords:["handbag","purse","bag","satchel"],category:{tier1:"Women",tier2:"Bags & Purses"}},{keywords:["necklace","pendant","chain"],category:{tier1:"Women",tier2:"Jewelry",tier3:"Necklaces"}},{keywords:["earrings","studs","hoops"],category:{tier1:"Women",tier2:"Jewelry",tier3:"Earrings"}},{keywords:["bracelet","bangle"],category:{tier1:"Women",tier2:"Jewelry",tier3:"Bracelets"}},{keywords:["ring","band"],category:{tier1:"Women",tier2:"Jewelry",tier3:"Rings"}},{keywords:["jeans"],category:{tier1:"Women",tier2:"Jeans"}},{keywords:["pants","trousers","slacks"],category:{tier1:"Women",tier2:"Pants"}},{keywords:["skirt","mini skirt","pencil skirt"],category:{tier1:"Women",tier2:"Skirts"}},{keywords:["shorts"],category:{tier1:"Women",tier2:"Shorts"}},{keywords:["jacket","coat","blazer"],category:{tier1:"Women",tier2:"Jackets & Coats"}},{keywords:["sweater","cardigan","pullover"],category:{tier1:"Women",tier2:"Sweaters"}},{keywords:["swimsuit","bikini","swimwear","bathing suit"],category:{tier1:"Women",tier2:"Swim"}},{keywords:["lingerie","bra","underwear","panties","intimates"],category:{tier1:"Women",tier2:"Intimates & Sleepwear"}},{keywords:["foundation","concealer","powder","blush","bronzer","makeup face"],category:{tier1:"Beauty",tier2:"Makeup",tier3:"Face"}},{keywords:["lipstick","lip gloss","lip liner","lip balm"],category:{tier1:"Beauty",tier2:"Makeup",tier3:"Lips"}},{keywords:["eyeshadow","eyeliner","mascara","eye makeup"],category:{tier1:"Beauty",tier2:"Makeup",tier3:"Eyes"}},{keywords:["nail polish","nail","manicure"],category:{tier1:"Beauty",tier2:"Makeup",tier3:"Nails"}},{keywords:["makeup","cosmetics"],category:{tier1:"Beauty",tier2:"Makeup"}},{keywords:["face mask","serum","moisturizer","cleanser","toner"],category:{tier1:"Beauty",tier2:"Skin Care",tier3:"Treatments & Masks"}},{keywords:["skincare","skin care"],category:{tier1:"Beauty",tier2:"Skin Care"}},{keywords:["perfume","cologne","fragrance","eau de"],category:{tier1:"Beauty",tier2:"Fragrance",tier3:"Perfume"}},{keywords:["shampoo","conditioner","hair treatment"],category:{tier1:"Beauty",tier2:"Hair Care",tier3:"Shampoo & Conditioner"}},{keywords:["hair care","hair product"],category:{tier1:"Beauty",tier2:"Hair Care"}},{keywords:["bath","body wash","soap","lotion"],category:{tier1:"Beauty",tier2:"Bath & Body"}},{keywords:["action figure","toy figure"],category:{tier1:"Kids",tier2:"Toys",tier3:"Action Figures & Accessories"}},{keywords:["doll","barbie"],category:{tier1:"Kids",tier2:"Toys",tier3:"Dolls"}},{keywords:["lego","building blocks","construction toy"],category:{tier1:"Kids",tier2:"Toys",tier3:"Building Toys"}},{keywords:["board game","puzzle","game"],category:{tier1:"Kids",tier2:"Toys",tier3:"Games & Puzzles"}},{keywords:["stuffed animal","plush","teddy bear"],category:{tier1:"Kids",tier2:"Toys",tier3:"Stuffed Animals"}},{keywords:["toy","toys"],category:{tier1:"Kids",tier2:"Toys"}},{keywords:["onesie","bodysuit","baby clothes"],category:{tier1:"Kids",tier2:"Baby Clothing",tier3:"Bodysuits"}},{keywords:["baby","infant","toddler"],category:{tier1:"Kids",tier2:"Baby Clothing"}},{keywords:["kids shirt","children shirt","boys shirt","girls shirt"],category:{tier1:"Kids",tier2:"Kids Clothing",tier3:"Tops & T-Shirts"}},{keywords:["kids","child","children","boy","girl"],category:{tier1:"Kids",tier2:"Kids Clothing"}},{keywords:["phone case","iphone case","android case","cell phone case"],category:{tier1:"Electronics",tier2:"Cell Phones & Accessories",tier3:"Cases & Covers"}},{keywords:["unlocked phone","smartphone","cell phone","mobile phone"],category:{tier1:"Electronics",tier2:"Cell Phones & Accessories",tier3:"Unlocked Phones"}},{keywords:["phone","iphone","android"],category:{tier1:"Electronics",tier2:"Cell Phones & Accessories"}},{keywords:["ps5","ps4","playstation","xbox","nintendo switch","console"],category:{tier1:"Electronics",tier2:"Video Games & Consoles",tier3:"Consoles"}},{keywords:["video game","game disc","ps5 game","xbox game","switch game"],category:{tier1:"Electronics",tier2:"Video Games & Consoles",tier3:"Games"}},{keywords:["gaming","video game"],category:{tier1:"Electronics",tier2:"Video Games & Consoles"}},{keywords:["laptop","macbook","notebook computer"],category:{tier1:"Electronics",tier2:"Computers & Tablets",tier3:"Laptops"}},{keywords:["tablet","ipad"],category:{tier1:"Electronics",tier2:"Computers & Tablets",tier3:"Tablets"}},{keywords:["computer","pc"],category:{tier1:"Electronics",tier2:"Computers & Tablets"}},{keywords:["headphones","earbuds","airpods","earphones"],category:{tier1:"Electronics",tier2:"Audio",tier3:"Headphones"}},{keywords:["speaker","bluetooth speaker"],category:{tier1:"Electronics",tier2:"Audio",tier3:"Speakers"}},{keywords:["camera","dslr","canon","nikon"],category:{tier1:"Electronics",tier2:"Cameras & Photography"}},{keywords:["watch","smartwatch","apple watch","fitbit"],category:{tier1:"Electronics",tier2:"Wearables"}},{keywords:["electronics","electronic"],category:{tier1:"Electronics",tier2:"Other"}},{keywords:["men shirt","mens shirt","men's shirt","button down","dress shirt"],category:{tier1:"Men",tier2:"Tops",tier3:"T-Shirts"}},{keywords:["men jeans","mens jeans","men's jeans"],category:{tier1:"Men",tier2:"Bottoms",tier3:"Jeans"}},{keywords:["men pants","mens pants","men's pants","chinos","khakis"],category:{tier1:"Men",tier2:"Bottoms"}},{keywords:["men sneakers","mens sneakers","men's sneakers"],category:{tier1:"Men",tier2:"Shoes",tier3:"Sneakers"}},{keywords:["men shoes","mens shoes","men's shoes"],category:{tier1:"Men",tier2:"Shoes"}},{keywords:["men shorts","mens shorts","men's shorts"],category:{tier1:"Men",tier2:"Athletic Apparel",tier3:"Shorts"}},{keywords:["men jacket","mens jacket","men's jacket","men coat"],category:{tier1:"Men",tier2:"Jackets & Coats"}},{keywords:["men watch","mens watch","men's watch"],category:{tier1:"Men",tier2:"Accessories",tier3:"Watches"}},{keywords:["tie","necktie","bow tie"],category:{tier1:"Men",tier2:"Accessories",tier3:"Ties"}},{keywords:["men","mens","men's","male"],category:{tier1:"Men",tier2:"Other"}},{keywords:["dinnerware","plates","bowls","dishes"],category:{tier1:"Home",tier2:"Kitchen & Dining",tier3:"Dinnerware"}},{keywords:["kitchen storage","food storage"],category:{tier1:"Home",tier2:"Kitchen & Dining",tier3:"Storage & Organization"}},{keywords:["kitchen","cookware","utensils"],category:{tier1:"Home",tier2:"Kitchen & Dining"}},{keywords:["sheets","bed sheets","bedding"],category:{tier1:"Home",tier2:"Bedding",tier3:"Sheets"}},{keywords:["comforter","duvet"],category:{tier1:"Home",tier2:"Bedding"}},{keywords:["candle","candle holder"],category:{tier1:"Home",tier2:"Home Decor",tier3:"Candles & Holders"}},{keywords:["home decor","decor","pillow","throw","vase"],category:{tier1:"Home",tier2:"Home Decor"}},{keywords:["chair","table","furniture"],category:{tier1:"Home",tier2:"Furniture",tier3:"Chairs"}},{keywords:["bath","bathroom"],category:{tier1:"Home",tier2:"Bath"}},{keywords:["home"],category:{tier1:"Home",tier2:"Other"}},{keywords:["exercise","fitness equipment","weights","dumbbells"],category:{tier1:"Sports & Outdoors",tier2:"Exercise & Fitness"}},{keywords:["camping","hiking","outdoor gear"],category:{tier1:"Sports & Outdoors",tier2:"Outdoor Recreation"}},{keywords:["bicycle","bike","cycling"],category:{tier1:"Sports & Outdoors",tier2:"Cycling"}},{keywords:["sports","athletic equipment"],category:{tier1:"Sports & Outdoors",tier2:"Athletic Equipment"}},{keywords:["vintage toy","retro toy","antique toy"],category:{tier1:"Vintage & Collectibles",tier2:"Vintage Toys"}},{keywords:["collectible","memorabilia","antique"],category:{tier1:"Vintage & Collectibles",tier2:"Collectibles"}},{keywords:["vintage","retro"],category:{tier1:"Vintage & Collectibles",tier2:"Other"}},{keywords:["handmade jewelry","handcrafted jewelry"],category:{tier1:"Handmade",tier2:"Jewelry"}},{keywords:["handmade","handcrafted","diy","craft"],category:{tier1:"Handmade",tier2:"Other"}},{keywords:["office","desk","supplies","stationery"],category:{tier1:"Office",tier2:"Other"}},{keywords:["dog","puppy","cat","kitten","pet"],category:{tier1:"Pet Supplies",tier2:"Other"}}];function s(e){const t=[e.tier1,e.tier2];return e.tier3&&t.push(e.tier3),t.join("/")}const a=new class{delay(e,t){const i=Math.floor(Math.random()*(t-e+1))+e;return new Promise(e=>setTimeout(e,i))}async typeText(e,t){e.focus(),e.value="";for(const i of t)e.value+=i,e.dispatchEvent(new Event("input",{bubbles:!0})),await this.delay(50,150);e.dispatchEvent(new Event("change",{bubbles:!0})),e.blur()}async clickElement(e){await this.delay(500,2e3),e.scrollIntoView({behavior:"smooth",block:"center"}),await this.delay(200,500),e.click()}async waitForElement(e,t=1e4){const i=Date.now();for(;Date.now()-i<t;){const t=document.querySelector(e);if(t)return t;await this.delay(100,300)}throw new Error(`Element not found: ${e}`)}async downloadImage(e){const t=await fetch(e);if(!t.ok)throw new Error(`Failed to download image: ${t.statusText}`);return await t.blob()}async uploadImages(o){if(!o||0===o.length)return void i("No photo URLs provided, skipping image upload");t(`Uploading ${o.length} images to Mercari`,o);const s=o.slice(0,12);let a=0;await this.waitForElement('[data-testid="PhotoUploadBox"]'),t("Found photo upload box");for(let i=0;i<s.length;i++){e((s.length,s[i]));try{const e=document.querySelector('input[type="file"][accept*="image"]');if(!e)throw new Error("Could not find file input");t("Found file input:",e),t(`Downloading image from: ${s[i]}`);const r=await this.downloadImage(s[i]);t(`Downloaded blob: size=${r.size}, type=${r.type}`);const o=`image-${i+1}.jpg`,n=new File([r],o,{type:r.type||"image/jpeg"});t(`Created file: name=${n.name}, size=${n.size}, type=${n.type}`);const c=new DataTransfer;c.items.add(n),t(`DataTransfer files: ${c.files.length}`),e.files=c.files;const l=["input","change"];for(const t of l)e.dispatchEvent(new Event(t,{bubbles:!0}));t(`Triggered events for image ${i+1}, waiting for upload...`),await this.delay(2e3,3e3),a++,t(`Successfully uploaded image ${i+1}/${s.length}`)}catch(e){r(`Failed to upload image ${i+1}:`,e)}}if(0===a)throw new Error("Failed to upload any images");t(`${a}/${s.length} images uploaded successfully`)}async fillTitle(e){const t=await this.waitForElement('input[data-testid="Title"]');await this.typeText(t,e)}async fillDescription(e){const t=await this.waitForElement('textarea[data-testid="Description"]');await this.typeText(t,e)}async selectCategory(e,o,a){t("Selecting Mercari category:",s(e));try{const r=await this.waitForElement("button.CategorySection__SelectButton-sc-d0fb8a6d-0",5e3);await this.clickElement(r),await this.delay(1e3,1500);const o=document.querySelectorAll(".CategoryDialog__ButtonWrapper-sc-13509435-1");if(o.length>0){t(`Found ${o.length} tier 1 (main) category options`);let r=null;for(const t of Array.from(o))if((t.textContent?.trim()||"").toLowerCase()===e.tier1.toLowerCase()){r=t;break}if(!r)for(const t of Array.from(o))if((t.textContent?.toLowerCase()||"").includes(e.tier1.toLowerCase())){r=t;break}if(!r){i(`Tier 1 category "${e.tier1}" not found, using Women as default`);for(const e of Array.from(o))if((e.textContent?.toLowerCase()||"").includes("women")){r=e;break}}if(!r)throw new Error("Could not find any tier 1 category");t(`Selecting tier 1: ${r.textContent?.trim()}`),await this.clickElement(r),await this.delay(1500,2e3)}const s=document.querySelectorAll(".CategoryDialog__ButtonWrapper-sc-13509435-1");if(s.length>0){t(`Found ${s.length} tier 2 (subcategory) options`);let r=null;for(const t of Array.from(s))if((t.textContent?.trim()||"").toLowerCase()===e.tier2.toLowerCase()){r=t;break}if(!r)for(const t of Array.from(s))if((t.textContent?.toLowerCase()||"").includes(e.tier2.toLowerCase())){r=t;break}if(!r){i(`Tier 2 category "${e.tier2}" not found, looking for "Other"`);for(const e of Array.from(s))if("other"===(e.textContent?.toLowerCase().trim()||"")){r=e;break}r||(r=s[s.length-1])}if(r){const i=r.textContent?.trim();if(t(`Selecting tier 2: ${i}`),await this.clickElement(r),await this.delay(1500,2e3),"other"===i?.toLowerCase()&&!e.tier3){t('Selected "Other" subcategory, looking for "All Other" tier 3...');const e=document.querySelectorAll(".CategoryDialog__ButtonWrapper-sc-13509435-1");if(e.length>0)for(const i of Array.from(e))if("all other"===(i.textContent?.toLowerCase().trim()||""))return t('Found "All Other" tier 3, selecting it'),await this.clickElement(i),await this.delay(2e3,3e3),void t("Category selection completed")}}}if(e.tier3){const r=document.querySelectorAll(".CategoryDialog__ButtonWrapper-sc-13509435-1");if(r.length>0){t(`Found ${r.length} tier 3 (sub-subcategory) options`);let o=null;for(const t of Array.from(r))if((t.textContent?.trim()||"").toLowerCase()===e.tier3.toLowerCase()){o=t;break}if(!o)for(const t of Array.from(r))if((t.textContent?.toLowerCase()||"").includes(e.tier3.toLowerCase())){o=t;break}o?(t(`Selecting tier 3: ${o.textContent?.trim()}`),await this.clickElement(o)):i(`Tier 3 category "${e.tier3}" not found, skipping`)}}await this.delay(2e3,3e3),t("Category selection completed")}catch(e){r("Failed to select category:",e)}}async fillBrand(e){try{const i=await this.waitForElement('input[data-testid="Brand"]'),r=e&&"n/a"!==e.toLowerCase()&&"none"!==e.toLowerCase()?e:"No brand";await this.typeText(i,r),await this.delay(500,1e3),await this.delay(500,1e3);const o=document.querySelectorAll('[role="option"]');o.length>0&&(t("Selecting first brand suggestion"),await this.clickElement(o[0]))}catch(e){throw i("Failed to fill brand:",e),e}}async selectCondition(e){try{const i={new:"ConditionNew",like_new:"ConditionLikeNew",good:"ConditionGood",fair:"ConditionFair",poor:"ConditionPoor"}[e]||"ConditionGood",r=await this.waitForElement(`label[data-testid="${i}"]`);await this.clickElement(r),await this.delay(500,1e3),t(`Selected condition: ${i}`)}catch(e){throw i("Failed to select condition:",e),e}}async selectSize(e){try{t("Looking for size dropdown...");const r=await this.waitForElement('[data-testid="Size"]',5e3);t("Size field found! Selecting size..."),r.scrollIntoView({behavior:"smooth",block:"center"}),await this.delay(500,1e3),t("Clicking size dropdown..."),await this.clickElement(r),await this.delay(1e3,1500);const o=document.querySelectorAll('[data-testid="Size-option"]');if(o.length>0){if(t(`Found ${o.length} size options`),!e||"n/a"===e.toLowerCase()||"none"===e.toLowerCase()){for(const e of Array.from(o))if(e.textContent?.includes("One Size"))return void await this.clickElement(e);return void await this.clickElement(o[0])}const r=e.toUpperCase();for(const t of Array.from(o)){const i=t.textContent||"";if(i.includes(r)||i.includes(e)||r.length<=3&&i.startsWith(r))return void await this.clickElement(t)}i(`Size "${e}" not found, selecting first option`),await this.clickElement(o[0])}}catch(e){t("Size field not found - skipping (not required for this category)")}}async selectShipping(e,i,o,s){t("Selecting shipping:",{weightLb:e,weightOz:i,preferredCarrier:o,preferredType:s});try{const r=await this.waitForElement('input[data-testid="SelectShipping"]');t("Found shipping input, clicking to open dialog..."),await this.clickElement(r),await this.delay(1e3,2e3);const a=await this.waitForElement('input[data-testid="ItemWeightInPounds"]');if(t("Found pounds input, entering weight:",e),await this.typeText(a,e.toString()),await this.delay(500,1e3),i>0){const e=await this.waitForElement('input[data-testid="ItemWeightInOunces"]');t("Found ounces input, entering weight:",i),await this.typeText(e,i.toString()),await this.delay(500,1e3)}const n=await this.waitForElement('button[data-testid="SelectCarrierButton"]');t("Clicking Next to view carrier options..."),await this.clickElement(n),await this.delay(2e3,3e3);const c=await this.waitForElement('div[data-testid="shipping-choices"]');t("Shipping options loaded");const l=c.querySelectorAll('div[data-role="shipping-choice"]');if(t(`Found ${l.length} shipping options`),0===l.length)throw new Error("No shipping options available");let d=null;if(o&&"cheapest"!==o&&s&&"auto"!==s){t("Looking for preferred carrier:",o,"type:",s);const e={usps:"shippo_usps",ups:"ups",fedex:"fedex"}[o]||o,i={ground_advantage:"standard",priority:"standard",media_mail:"media_mail",surepost:"surepost",ground:"standard",smartpost:"smartpost",home:"standard"}[s]||"standard";for(const r of Array.from(l)){const o=r.getAttribute("data-carrier"),a=r.getAttribute("data-handling-type"),n=r.getAttribute("data-display-name")||"";if(o===e&&a===i){t("Found matching preferred option:",n),d=r;break}if("priority"===s&&n.includes("Priority Mail")){t("Found Priority Mail option:",n),d=r;break}}}if(!d){t("Finding cheapest shipping option...");let e=1/0;for(const t of Array.from(l)){const i=t.querySelector('h5[color="black"]');if(!i)continue;const r=(i.textContent||"").match(/\$(\d+\.\d+)/);if(r){const i=parseFloat(r[1]);i<e&&(e=i,d=t)}}if(d){const i=d.getAttribute("data-display-name");t("Selected cheapest option:",i,`($${e.toFixed(2)})`)}}d||(d=l[0],t("Using fallback: selecting first option"));const y=d.querySelector('input[type="radio"]');if(!y)throw new Error("Could not find radio button for shipping option");t("Clicking radio button to select shipping option..."),await this.clickElement(y),await this.delay(1e3,2e3),t("Shipping option selected successfully")}catch(e){throw r("Failed to select shipping:",e),e}}async fillPrice(e,r){try{const o=await this.waitForElement('input[data-testid="Price"]');if(o.focus(),await this.delay(100,200),o.value=String(Math.ceil(e)),o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0})),await this.delay(300,500),o.blur(),await this.delay(1e3,1500),r&&r>0){t("Setting floor price for smart pricing:",r);const e=await this.waitForElement('input[data-testid="SmartPricingFloorPrice"]');e.focus(),await this.delay(100,200),e.value=String(Math.ceil(r)),e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),await this.delay(200,300),e.blur()}else{t("Turning off smart pricing");try{if(document.querySelector('button[data-testid="SmartPricingButton"][aria-pressed="true"]')){const e=await this.waitForElement('button[data-testid="SmartPricingTurnOffButton"]',3e3);await this.clickElement(e),await this.delay(500,1e3)}}catch(e){i("Could not turn off smart pricing:",e)}}t("Price set to:",e)}catch(e){throw i("Failed to fill price:",e),e}}async submitListing(){try{const e=await this.waitForElement('button[data-testid="ListButton"]',1e4);t("Found List button");const r=e.disabled;if(t("List button disabled state:",r),r){t("List button is disabled, waiting for it to be enabled...");let i=0;for(;e.disabled&&i<10;)await this.delay(500,1e3),i++;if(e.disabled)throw new Error("List button remained disabled after waiting");t("List button is now enabled")}e.scrollIntoView({behavior:"smooth",block:"center"}),await this.delay(500,1e3),t("Clicking List button to submit listing...");let o=!1;for(let r=1;r<=3;r++)try{t(`Click attempt ${r}/3`),await this.clickElement(e),o=!0,t("Successfully clicked List button");break}catch(e){i(`Click attempt ${r} failed:`,e),r<3&&await this.delay(1e3,2e3)}if(!o)throw new Error("Failed to click List button after 3 attempts");t("Waiting for page navigation after submission..."),await this.delay(3e3,5e3);const s=window.location.href;if(t("Current URL after submission:",s),s.includes("/item/")||s.includes("/mypage/listings")){t("Listing submitted successfully - redirected to success page");const e=s.match(/\/item\/m(\d+)/);return{platformListingId:e?e[1]:"success",platformUrl:s}}return t("Listing submitted (checking for success - still on sell page)"),{platformListingId:"success",platformUrl:s}}catch(e){throw r("Failed to submit listing:",e),e}}async createListing(e){try{let r;t("Starting Mercari listing creation for:",e.title),t("Listing data received:",JSON.stringify(e)),t("Photo URLs:",e.photo_urls),await this.uploadImages(e.photo_urls),await this.fillTitle(e.title),await this.fillDescription(e.description),e.mercari_category?(t("Using pre-determined Mercari category:",e.mercari_category),r=function(e){const t=e.split("/").map(e=>e.trim());return{tier1:t[0]||"Women",tier2:t[1]||"Other",tier3:t[2]}}(e.mercari_category)):(t("Auto-detecting Mercari category from listing data"),r=function(e,t="",i=""){const r=`${e} ${t} ${i}`.toLowerCase();for(const e of o)for(const t of e.keywords)if(r.includes(t.toLowerCase()))return e.category;return{tier1:"Women",tier2:"Other",tier3:"All Other"}}(e.title,e.description,e.category||""),t("Suggested category:",s(r))),await this.selectCategory(r,e.title,e.description),await this.fillBrand(e.brand),await this.selectCondition(e.condition),await this.selectSize(e.size);const a=e.weight_lb||0,n=e.weight_oz||0;0===a&&0===n&&i("No weight specified, using default 1 lb"),await this.selectShipping(a||1,n||0,e.mercari_shipping_carrier||"cheapest",e.mercari_shipping_type||"auto");const c=e.original_price&&e.original_price<e.price?e.original_price:void 0;await this.fillPrice(e.price,c),t("Waiting for form to be ready for submission..."),await this.delay(2e3,3e3);const l=await this.submitListing();return{success:!0,listingId:e.id,platform:"mercari",platformListingId:l.platformListingId,platformUrl:l.platformUrl}}catch(t){return r("Failed to create Mercari listing:",t),{success:!1,listingId:e.id,platform:"mercari",error:t instanceof Error?t.message:"Unknown error"}}}};chrome.runtime.onMessage.addListener((e,t,i)=>{if(e.type,"CREATE_LISTING"===e.type){const{listingData:t}=e.payload;return a.createListing(t).then(e=>{i(e)}).catch(e=>{i({success:!1,listingId:t.id,platform:"mercari",error:e.message})}),!0}}),t("Mercari content script loaded")})();