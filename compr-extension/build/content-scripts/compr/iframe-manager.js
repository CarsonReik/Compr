(()=>{"use strict";const e=(...e)=>{console.info("[Compr Extension]",...e)};chrome.runtime.onMessage.addListener((t,o,n)=>{if("CREATE_IFRAME"===t.type)return async function(t){const{url:o,listingData:n,platform:r}=t;e(`Creating hidden iframe for ${r} listing`);const i=document.createElement("iframe");i.src=o,i.style.position="fixed",i.style.top="-9999px",i.style.left="-9999px",i.style.width="1200px",i.style.height="800px",i.style.border="none",i.style.opacity="0",i.style.pointerEvents="none",document.body.appendChild(i);try{await new Promise((e,t)=>{const o=setTimeout(()=>{t(new Error("Iframe load timeout"))},3e4);i.onload=()=>{clearTimeout(o),setTimeout(e,8e3)},i.onerror=()=>{clearTimeout(o),t(new Error("Iframe failed to load"))}}),e("Iframe loaded, starting listing automation");const t=await async function(e,t,o){return new Promise((n,r)=>{const i=setTimeout(()=>{r(new Error("Iframe listing timeout - no response from content script"))},12e4),a=t=>{t.source===e.contentWindow&&("LISTING_RESULT"===t.data.type?(clearTimeout(i),window.removeEventListener("message",a),n(t.data.result)):"LISTING_ERROR"===t.data.type&&(clearTimeout(i),window.removeEventListener("message",a),r(new Error(t.data.error))))};window.addEventListener("message",a),e.contentWindow?.postMessage({type:"CREATE_LISTING",listingData:t,platform:o},"*")})}(i,n,r);return e("Listing automation completed:",t),t}finally{setTimeout(()=>{e("Removing iframe"),i.remove()},2e3)}}(t.payload).then(e=>n(e)).catch(e=>n({success:!1,error:e.message})),!0}),e("Compr iframe manager loaded")})();