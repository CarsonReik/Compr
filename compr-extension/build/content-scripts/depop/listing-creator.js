(()=>{"use strict";var e,t,o;!function(e){e.CONDITIONS={new:{value:"nwt",label:"NWT (New With Tags)"},like_new:{value:"nwot",label:"NWOT (New Without Tags)"},good:{value:"good",label:"Good - Used"},fair:{value:"fair",label:"Fair - Used"},poor:{value:"poor",label:"Poor - Used"}}}(e||(e={})),function(e){e.CONDITIONS={new:{value:"new",label:"New"},like_new:{value:"like_new",label:"Like New"},good:{value:"good",label:"Good"},fair:{value:"fair",label:"Fair"},poor:{value:"poor",label:"Poor"}}}(t||(t={})),function(e){e.CONDITIONS={new:{value:"brand_new",label:"Brand new"},like_new:{value:"like_new",label:"Like new"},good:{value:"used_excellent",label:"Used - Excellent"},fair:{value:"used_good",label:"Used - Good"},poor:{value:"used_fair",label:"Used - Fair"}},e.PARCEL_SIZES={extra_extra_small:{maxOz:4,label:"Extra extra small",price:4.99},extra_small:{maxOz:8,label:"Extra small",price:5.99},small:{maxOz:12,label:"Small",price:6.49},medium:{maxLb:1,label:"Medium",price:7.99},large:{maxLb:2,label:"Large",price:11.99},extra_large:{maxLb:10,label:"Extra large",price:13.99}}}(o||(o={})),Error;const i=(...e)=>{},a=(...e)=>{console.info("[Compr Extension]",...e)},n=(...e)=>{console.warn("[Compr Extension]",...e)},l=(...e)=>{console.error("[Compr Extension]",...e)},s=new class{delay(e,t){const o=Math.floor(Math.random()*(t-e+1))+e;return new Promise(e=>setTimeout(e,o))}async typeText(e,t){e.focus(),e.value="";for(const o of t)e.value+=o,e.dispatchEvent(new Event("input",{bubbles:!0})),await this.delay(50,150);e.dispatchEvent(new Event("change",{bubbles:!0})),e.blur()}async clickElement(e){await this.delay(500,2e3),e.scrollIntoView({behavior:"smooth",block:"center"}),await this.delay(200,500),e.click()}async waitForElement(e,t=1e4){const o=Date.now();for(;Date.now()-o<t;){const t=document.querySelector(e);if(t)return t;await this.delay(100,300)}throw new Error(`Element not found: ${e}`)}async downloadImage(e){const t=await fetch(e);if(!t.ok)throw new Error(`Failed to download image: ${t.statusText}`);return await t.blob()}async uploadImages(e){if(!e||0===e.length)return void n("No photo URLs provided, skipping image upload");a(`Uploading ${e.length} images to Depop`,e);const t=e.slice(0,4);let o=0;for(let e=0;e<t.length;e++){i((t.length,t[e]));try{const i=await this.waitForElement('input[data-testid="upload-input__input"]');a("Found file input:",i),a(`Downloading image from: ${t[e]}`);const n=await this.downloadImage(t[e]);a(`Downloaded blob: size=${n.size}, type=${n.type}`);const l=`image-${e+1}.jpg`,s=new File([n],l,{type:n.type||"image/jpeg"});a(`Created file: name=${s.name}, size=${s.size}, type=${s.type}`);const r=new DataTransfer;r.items.add(s),a(`DataTransfer files: ${r.files.length}`),i.files=r.files;const c=["input","change"];for(const e of c)i.dispatchEvent(new Event(e,{bubbles:!0}));a(`Triggered events for image ${e+1}, waiting for upload...`),await this.delay(2e3,3e3),o++,a(`Successfully uploaded image ${e+1}/${t.length}`)}catch(t){l(`Failed to upload image ${e+1}:`,t)}}if(0===o)throw new Error("Failed to upload any images");a(`${o}/${t.length} images uploaded successfully`)}async fillTitle(e){}async fillDescription(e){const t=e.length>1e3?e.substring(0,1e3):e,o=await this.waitForElement('textarea#description[name="description"]');await this.typeText(o,t)}async selectCategory(e,t){try{const o=await this.waitForElement('input#group-input[role="combobox"]');if(await this.clickElement(o),await this.delay(1e3,1500),e){const t=document.querySelectorAll('ul#group-menu li[role="option"]');a(`Found ${t.length} category options`);for(const o of Array.from(t)){const t=o.textContent?.trim()||"";if(t.toLowerCase().includes(e.toLowerCase())){a(`Selecting category: ${t}`),await this.clickElement(o),await this.delay(1e3,1500);break}}}else{const e=document.querySelector('ul#group-menu li[role="option"]');e&&(await this.clickElement(e),await this.delay(1e3,1500))}if(t){await this.delay(1e3,1500);const e=await this.waitForElement('input#productType-input[role="combobox"]',5e3);await this.clickElement(e),await this.delay(1e3,1500);const o=document.querySelectorAll('ul#productType-menu li[role="option"]');a(`Found ${o.length} subcategory options`);for(const e of Array.from(o)){const o=e.textContent?.trim()||"";if(o.toLowerCase().includes(t.toLowerCase())){a(`Selecting subcategory: ${o}`),await this.clickElement(e),await this.delay(500,1e3);break}}}}catch(e){throw n("Failed to select category:",e),e}}async fillBrand(e){try{const t=await this.waitForElement('input#brand-input[role="combobox"]');if(e){await this.typeText(t,e),await this.delay(500,1e3);const o=document.querySelectorAll('ul#brand-menu li[role="option"]');o.length>0&&(a("Selecting first brand option"),await this.clickElement(o[0]))}else{await this.typeText(t,"No brand"),await this.delay(500,1e3);const e=document.querySelectorAll('ul#brand-menu li[role="option"]');e.length>0&&await this.clickElement(e[0])}}catch(e){throw n("Failed to fill brand:",e),e}}async selectSize(e){if(e)try{const t=await this.waitForElement('input#variants-input[role="combobox"]',5e3);await this.clickElement(t),await this.delay(500,1e3);const o=document.querySelectorAll('ul#variants-menu li[role="option"]');a(`Found ${o.length} size options`);for(const t of Array.from(o)){const o=t.textContent?.toLowerCase()||"";if(o.includes(e.toLowerCase()))return a(`Selecting size: ${o}`),void await this.clickElement(t)}o.length>0&&(n(`Size "${e}" not found, selecting first option`),await this.clickElement(o[0]))}catch(e){a("Size field not found or failed to select - skipping (optional)")}}async selectColor(e){if(e)try{const t=await this.waitForElement('input#colour-input[role="combobox"]',5e3);await this.clickElement(t),await this.delay(500,1e3);const o=document.querySelectorAll('ul#colour-menu li[role="option"]');a(`Found ${o.length} color options`);for(const t of Array.from(o)){const o=t.textContent?.toLowerCase()||"";if(o.includes(e.toLowerCase()))return a(`Selecting color: ${o}`),void await this.clickElement(t)}n(`Color "${e}" not found in options`)}catch(e){a("Color field not found or failed to select - skipping (optional)")}}async selectCondition(e){const t=o.CONDITIONS[e]||o.CONDITIONS.good;try{const e=await this.waitForElement('input#condition-input[role="combobox"]');await this.clickElement(e),await this.delay(500,1e3);const o=document.querySelectorAll('ul#condition-menu li[role="option"]');a(`Found ${o.length} condition options`);for(const e of Array.from(o)){const o=e.textContent?.trim()||"";if(o.toLowerCase()===t.label.toLowerCase())return a(`Selecting condition: ${o}`),void await this.clickElement(e)}for(const e of Array.from(o)){const o=e.textContent?.toLowerCase()||"";if(o.includes(t.label.toLowerCase()))return a(`Selecting condition (partial match): ${o}`),void await this.clickElement(e)}for(const e of Array.from(o))if((e.textContent?.toLowerCase()||"").includes("good"))return n("Using default condition: Good"),void await this.clickElement(e)}catch(e){throw n("Failed to select condition:",e),e}}async fillPrice(e){try{const t=await this.waitForElement('input[data-testid="priceAmount__input"]');t.focus(),await this.delay(100,200),t.select(),t.value=e.toFixed(2),t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),await this.delay(300,500),t.blur(),a("Price set to:",t.value)}catch(e){throw n("Failed to fill price:",e),e}}async selectShipping(e,t){try{const o=16*(e||0)+(t||0),i=o/16;let l="Medium";l=o<4?"Extra extra small":o<8?"Extra small":o<12?"Small":i<1?"Medium":i<2?"Large":"Extra large",a(`Selecting parcel size: ${l} (${i.toFixed(2)} lb)`);const s=await this.waitForElement('input#shippingMethods-input[role="combobox"]');await this.clickElement(s),await this.delay(500,1e3);const r=document.querySelectorAll('ul#shippingMethods-menu li[role="option"]');a(`Found ${r.length} shipping options`);for(const e of Array.from(r))if((e.textContent?.toLowerCase()||"").includes(l.toLowerCase()))return a(`Selecting shipping option: ${l}`),void await this.clickElement(e);for(const e of Array.from(r))if((e.textContent?.toLowerCase()||"").includes("medium"))return n("Using default parcel size: Medium"),void await this.clickElement(e)}catch(e){throw n("Failed to select shipping:",e),e}}async submitListing(){try{const e=await this.waitForElement('button[type="submit"]',1e4);a("Found Post button, clicking..."),await this.clickElement(e),await this.delay(3e3,5e3);const t=window.location.href;a("Current URL after submission:",t);const o=t.match(/\/products\/([a-zA-Z0-9_-]+)/),i=o?o[1]:"success";return a("Listing submitted successfully:",{platformListingId:i,platformUrl:t}),{platformListingId:i,platformUrl:t}}catch(e){throw l("Failed to submit listing:",e),e}}async createListing(e){try{a("Starting Depop listing creation for:",e.title),a("Listing data received:",JSON.stringify(e)),a("Photo URLs:",e.photo_urls),await this.uploadImages(e.photo_urls),await this.fillTitle(e.title),await this.fillDescription(e.description),await this.selectCategory(e.depop_category||e.category,e.depop_subcategory||null),await this.fillBrand(e.brand),await this.selectSize(e.size),await this.selectColor(e.color),await this.selectCondition(e.condition),await this.fillPrice(e.price),await this.selectShipping(e.weight_lb,e.weight_oz),a("Waiting for form to be ready for submission..."),await this.delay(2e3,3e3);const t=await this.submitListing();return{success:!0,listingId:e.id,platform:"depop",platformListingId:t.platformListingId,platformUrl:t.platformUrl}}catch(t){return l("Failed to create Depop listing:",t),{success:!1,listingId:e.id,platform:"depop",error:t instanceof Error?t.message:"Unknown error"}}}};function r(){return!!document.querySelector('[data-testid="user-menu"], [class*="UserMenu"], [class*="user-menu" i]')||!(window.location.pathname.includes("/login")||!document.querySelector('[href*="/sell"], [class*="sell" i]'))}chrome.runtime.onMessage.addListener((e,t,o)=>{if(e.type,"CREATE_LISTING"===e.type){const{listingData:t}=e.payload;return s.createListing(t).then(e=>{o(e)}).catch(e=>{o({success:!1,listingId:t.id,platform:"depop",error:e.message})}),!0}if("ATTEMPT_LOGIN"===e.type){const{username:t,password:i}=e.payload;return async function(e,t){try{if(a("Attempting Depop login for:",e),await s.delay(2e3,3e3),r())return a("User is already logged in to Depop"),{success:!0};window.location.pathname.includes("/login")||(n("Not on login page, redirecting..."),window.location.href="https://www.depop.com/login/",await s.delay(2e3,3e3));const o=await s.waitForElement('input[type="email"], input[name="username"], input[placeholder*="email" i]',1e4);await s.typeText(o,e);const i=await s.waitForElement('input[type="password"], input[name="password"]',5e3);await s.typeText(i,t);const l=await s.waitForElement('button[type="submit"]',5e3);if(await s.clickElement(l),await s.delay(3e3,5e3),r())return a("Depop login successful"),{success:!0};const c=document.querySelector('[role="alert"], [class*="error"], [class*="Error"]');if(c&&c.textContent){const e=c.textContent.trim();if(e.length>0)return n("Depop login failed:",e),{success:!1,error:e}}return window.location.pathname.includes("/login")?{success:!1,error:"Invalid username or password"}:{success:!0}}catch(e){return l("Depop login error:",e),{success:!1,error:e instanceof Error?e.message:"Login failed"}}}(t,i).then(e=>{o(e)}).catch(e=>{o({success:!1,error:e.message})}),!0}}),a("Depop content script loaded")})();